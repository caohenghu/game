!function(t){var e={};function r(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)r.d(o,n,function(e){return t[e]}.bind(null,n));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e){t.exports='<div class="wrap">\n    <div class="top">\n        <img class="preview" />\n        <div class="btns">\n            <div class="btn img">\n                <span>更换图片</span>\n                <input type="file" accept=".jpg,.jpge,.png" />\n            </div>\n            <span class="btn level">一级难度</span>\n            <span class="btn reset">重新开始</span>\n        </div>\n    </div>\n</div>\n'},function(t,e,r){var o=r(2),n=r(3);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[t.i,n,""]]);var i={insert:"head",singleton:!1},a=(o(n,i),n.locals?n.locals:{});t.exports=a},function(t,e,r){"use strict";var o,n=function(){return void 0===o&&(o=Boolean(window&&document&&document.all&&!window.atob)),o},i=function(){var t={};return function(e){if(void 0===t[e]){var r=document.querySelector(e);if(window.HTMLIFrameElement&&r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}t[e]=r}return t[e]}}(),a=[];function s(t){for(var e=-1,r=0;r<a.length;r++)if(a[r].identifier===t){e=r;break}return e}function c(t,e){for(var r={},o=[],n=0;n<t.length;n++){var i=t[n],c=e.base?i[0]+e.base:i[0],l=r[c]||0,h="".concat(c," ").concat(l);r[c]=l+1;var u=s(h),f={css:i[1],media:i[2],sourceMap:i[3]};-1!==u?(a[u].references++,a[u].updater(f)):a.push({identifier:h,updater:b(f,e),references:1}),o.push(h)}return o}function l(t){var e=document.createElement("style"),o=t.attributes||{};if(void 0===o.nonce){var n=r.nc;n&&(o.nonce=n)}if(Object.keys(o).forEach((function(t){e.setAttribute(t,o[t])})),"function"==typeof t.insert)t.insert(e);else{var a=i(t.insert||"head");if(!a)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");a.appendChild(e)}return e}var h,u=(h=[],function(t,e){return h[t]=e,h.filter(Boolean).join("\n")});function f(t,e,r,o){var n=r?"":o.media?"@media ".concat(o.media," {").concat(o.css,"}"):o.css;if(t.styleSheet)t.styleSheet.cssText=u(e,n);else{var i=document.createTextNode(n),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}function p(t,e,r){var o=r.css,n=r.media,i=r.sourceMap;if(n?t.setAttribute("media",n):t.removeAttribute("media"),i&&btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleSheet)t.styleSheet.cssText=o;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(o))}}var d=null,w=0;function b(t,e){var r,o,n;if(e.singleton){var i=w++;r=d||(d=l(e)),o=f.bind(null,r,i,!1),n=f.bind(null,r,i,!0)}else r=l(e),o=p.bind(null,r,e),n=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(r)};return o(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;o(t=e)}else n()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=n());var r=c(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var o=0;o<r.length;o++){var n=s(r[o]);a[n].references--}for(var i=c(t,e),l=0;l<r.length;l++){var h=s(r[l]);0===a[h].references&&(a[h].updater(),a.splice(h,1))}r=i}}}},function(t,e,r){(t.exports=r(4)(!1)).push([t.i,".wrap{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-align:center;align-items:center}.wrap .top{display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:justify;justify-content:space-between;width:306px;height:160px}.wrap .preview{box-sizing:border-box;max-width:160px;max-height:160px;border:4px solid #fff}.wrap .btns{display:-webkit-box;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;flex-direction:column;-webkit-box-pack:space-evenly;justify-content:space-evenly;height:160px}.wrap .btn{position:relative;box-sizing:border-box;display:-webkit-box;display:flex;-webkit-box-align:center;align-items:center;-webkit-box-pack:center;justify-content:center;width:110px;height:36px;font-size:16px;color:#fff;background:#6aae78;border:2px solid #fff;border-radius:18px;-webkit-tap-highlight-color:transparent;-webkit-transition:all 0.1s;transition:all 0.1s}.wrap .btn.reset{background:#e6a153}.wrap .btn:active{-webkit-transform:scale(1.1);transform:scale(1.1)}.wrap input{position:absolute;width:100%;height:100%;opacity:0}\n",""])},function(t,e,r){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var r=function(t,e){var r=t[1]||"",o=t[3];if(!o)return r;if(e&&"function"==typeof btoa){var n=(a=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),i=o.sources.map((function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"}));return[r].concat(i).concat([n]).join("\n")}var a;return[r].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r})).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var o={},n=0;n<this.length;n++){var i=this[n][0];null!=i&&(o[i]=!0)}for(n=0;n<t.length;n++){var a=t[n];null!=a[0]&&o[a[0]]||(r&&!a[2]?a[2]=r:r&&(a[2]="("+a[2]+") and ("+r+")"),e.push(a))}},e}},function(t,e,r){"use strict";function o(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}r.r(e);var n=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e.width,o=e.height,n=e.row,i=e.col;this.width=r,this.height=o,this.row=n,this.col=i,this.$el=document.createElement("div"),this.render()}var e,r,n;return e=t,(r=[{key:"render",value:function(){var t=this.$el,e=this.width,r=this.height,o=this.row,n=this.col,i=e/n,a=r/o;Object.assign(t.style,{position:"relative",display:"table",zIndex:1,pointerEvents:"none"});for(var s=0;s<o;s++){var c=document.createElement("div");Object.assign(c.style,{display:"table-row"});for(var l=0;l<n;l++){var h=document.createElement("div");Object.assign(h.style,{display:"table-cell",width:i+"px",height:a+"px",border:"1px solid #fff",boxSizing:"border-box"}),c.appendChild(h)}t.appendChild(c)}}}])&&o(e.prototype,r),n&&o(e,n),t}();function i(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.arrow={left:void 0,top:void 0,right:void 0,bottom:void 0}}var e,r,o;return e=t,(r=[{key:"setArrow",value:function(t){var e=t.left,r=t.right,o=t.top,n=t.bottom;this.arrow={left:e,right:r,top:o,bottom:n}}}])&&i(e.prototype,r),o&&i(e,o),t}();function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){return!e||"object"!==s(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var f=function(t){function e(){return c(this,e),l(this,h(e).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&u(t,e)}(e,t),e}(a),p=(["Win32","Windows"].includes(navigator.platform),["Mac68K","MacPPC","Macintosh","MacIntel"].includes(navigator.platform),/Chrome/.test(navigator.userAgent),/Firefox/.test(navigator.userAgent),/Safari/.test(navigator.userAgent),/Edge/.test(navigator.userAgent),/MicroMessenger/i.test(navigator.userAgent),/Android/i.test(navigator.userAgent)),d=/ipad|iphone/i.test(navigator.userAgent),w=p||d;window.top,window;var b=w?"touchstart":"click",g={mousedown:w?"touchstart":"mousedown",mousemove:w?"touchmove":"mousemove",mouseup:w?"touchend":"mouseup"};function v(t){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function m(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function y(t,e){return!e||"object"!==v(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function x(t){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function k(t,e){return(k=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var j=function(t){function e(t){var r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r=y(this,x(e).call(this));var o=t.sourcePos,n=t.width,i=t.height,a=t.img,s=t.imgWidth,c=t.imgHeight,l=t.parent;return r.sourcePos=o,r.nowPos=[],r.img=a,r.imgWidth=s,r.imgHeight=c,r.width=n,r.height=i,r.parent=l,r.$el=document.createElement("canvas"),r.render(),r.bindEvent(),r}var r,o,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&k(t,e)}(e,t),r=e,(o=[{key:"render",value:function(){var t=this.$el,e=this.img,r=this.sourcePos,o=this.imgWidth,n=this.imgHeight,i=this.width,a=this.height,s=t.getContext("2d");t.className="block",t.width=i,t.height=a,s.drawImage(e,r[0]*o,r[1]*n,o,n,0,0,i,a)}},{key:"setPos",value:function(t,e){this.nowPos=[t,e],Object.assign(this.$el.style,{position:"absolute",left:this.nowPos[0]*this.width+"px",top:this.nowPos[1]*this.height+"px"})}},{key:"bindEvent",value:function(){var t=this,e=this.$el;e.addEventListener(g.mousedown,(function(r){r.preventDefault();var o=e.offsetLeft,n=e.offsetTop,i=r.pageX||r.touches[0].pageX,a=r.pageY||r.touches[0].pageY,s=i,c=a,l=function(r){var i=r.pageX||r.touches[0].pageX,a=r.pageY||r.touches[0].pageY,l=i-s,h=a-c,u=o,p=n;t.arrow.left instanceof f&&l<0?u=o+Math.max(l,-t.width):t.arrow.right instanceof f&&l>0?u=o+Math.min(l,t.width):t.arrow.top instanceof f&&h<0?p=n+Math.max(h,-t.height):t.arrow.bottom instanceof f&&h>0&&(p=n+Math.min(h,t.height)),Object.assign(e.style,{left:u+"px",top:p+"px"})};document.addEventListener(g.mousemove,l),document.addEventListener(g.mouseup,(function r(i){var a=i.pageX||i.changedTouches[0].pageX,h=i.pageY||i.changedTouches[0].pageY,u=a-s,p=h-c,d=o,w=n;t.arrow.left instanceof f&&u<0?(d=o-t.width,t.setAllArrow("left")):t.arrow.right instanceof f&&u>0?(d=o+t.width,t.setAllArrow("right")):t.arrow.top instanceof f&&p<0?(w=n-t.height,t.setAllArrow("top")):t.arrow.bottom instanceof f&&p>0&&(w=n+t.height,t.setAllArrow("bottom")),Object.assign(e.style,{left:d+"px",top:w+"px"}),d===o&&w===n||t.parent.isSuccess(),document.removeEventListener(g.mousemove,l),document.removeEventListener(g.mouseup,r)}))}))}},{key:"setAllArrow",value:function(t){var e=null,r=this.arrow.left,o=this.arrow.right,n=this.arrow.top,i=this.arrow.bottom;"left"===t||"right"===t?("left"===t?((e=this.arrow.left).arrow.left&&(e.arrow.left.arrow.right=this),this.arrow.right&&(this.arrow.right.arrow.left=e),this.arrow.left=e.arrow.left,this.arrow.right=e,e.arrow.left=this,e.arrow.right=o,this.nowPos[0]--):((e=this.arrow.right).arrow.right&&(e.arrow.right.arrow.left=this),this.arrow.left&&(this.arrow.left.arrow.right=e),this.arrow.left=e,this.arrow.right=e.arrow.right,e.arrow.left=r,e.arrow.right=this,this.nowPos[0]++),e.arrow.top&&(e.arrow.top.arrow.bottom=this),e.arrow.bottom&&(e.arrow.bottom.arrow.top=this),this.arrow.top&&(this.arrow.top.arrow.bottom=e),this.arrow.bottom&&(this.arrow.bottom.arrow.top=e),this.arrow.top=e.arrow.top,this.arrow.bottom=e.arrow.bottom,e.arrow.top=n,e.arrow.bottom=i):("top"===t?((e=this.arrow.top).arrow.top&&(e.arrow.top.arrow.bottom=this),this.arrow.bottom&&(this.arrow.bottom.arrow.top=e),this.arrow.top=e.arrow.top,this.arrow.bottom=e,e.arrow.top=this,e.arrow.bottom=i,this.nowPos[1]--):((e=this.arrow.bottom).arrow.bottom&&(e.arrow.bottom.arrow.top=this),this.arrow.top&&(this.arrow.top.arrow.bottom=e),this.arrow.bottom=e.arrow.bottom,this.arrow.top=e,e.arrow.bottom=this,e.arrow.top=n,this.nowPos[1]++),e.arrow.left&&(e.arrow.left.arrow.right=this),e.arrow.right&&(e.arrow.right.arrow.left=this),this.arrow.left&&(this.arrow.left.arrow.right=e),this.arrow.right&&(this.arrow.right.arrow.left=e),this.arrow.left=e.arrow.left,this.arrow.right=e.arrow.right,e.arrow.left=r,e.arrow.right=o)}}])&&m(r.prototype,o),n&&m(r,n),e}(a);function O(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var P=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e.img,o=e.width,n=e.height,i=e.row,a=e.col;this.img=r,this.width=o,this.height=n,this.row=i,this.col=a,this.$el=document.createElement("div"),this.blocks=[],this.board=null,this.render(),this.renderBoard(),this.renderBlocks(),this.resetBlocks()}var e,r,o;return e=t,(r=[{key:"render",value:function(){Object.assign(this.$el.style,{position:"relative",width:this.width+"px",marginTop:"30px",background:"#756780",border:"3px solid #fff"})}},{key:"renderBoard",value:function(){var t={width:this.width,height:this.height,row:this.row,col:this.col};this.board=new n(t),this.$el.appendChild(this.board.$el)}},{key:"renderBlocks",value:function(){for(var t=this.width,e=this.height,r=this.row,o=this.col,n=this.img,i=this.blocks,a=this.$el,s=t/o,c=e/r,l=n.width/o,h=n.height/r,u=0;u<r;u++)for(var p=0;p<o&&(u!==this.row-1||p!==this.col-1);p++){var d=new j({sourcePos:[p,u],width:s,height:c,img:n,imgWidth:l,imgHeight:h,parent:this});i.push(d),a.appendChild(d.$el)}i.push(new f)}},{key:"isSuccess",value:function(){var t=!0;this.blocks.forEach((function(e){e instanceof j&&(e.sourcePos[0]!==e.nowPos[0]||e.sourcePos[1]!==e.nowPos[1])&&(t=!1)})),t&&setTimeout((function(){alert("挑战成功")}),300)}},{key:"resetBlocks",value:function(){for(var t=this.blocks.slice(0,-1).sort((function(){return Math.random()>.5?1:-1})),e=[],r=0;r<this.row;r++){for(var o=[],n=0;n<this.col;n++){if(r===this.row-1&&n===this.col-1){o.push(this.blocks[this.blocks.length-1]);break}var i=t[0];i.setPos(n,r),o.push(i),t.shift()}e.push(o)}e.forEach((function(t,r){t.forEach((function(o,n){var i={left:t[n-1],right:t[n+1],top:(e[r-1]||[])[n],bottom:(e[r+1]||[])[n]};o.setArrow(i)}))}))}},{key:"setSize",value:function(){var t=this.img.width/this.img.height,e=300,r=300;t>1?r=e/t:e=r*t,this.width=e,this.height=r}},{key:"changeImage",value:function(t){this.img=t,this.setSize(),this.render(),this.clearBlocks(),this.renderBlocks(),this.resetBlocks(),this.clearBoard(),this.renderBoard()}},{key:"changeLevel",value:function(t,e){this.row=t,this.col=e,this.clearBlocks(),this.renderBlocks(),this.resetBlocks(),this.clearBoard(),this.renderBoard()}},{key:"clearBlocks",value:function(){var t=this;this.blocks.forEach((function(e){e instanceof j&&t.$el.removeChild(e.$el)})),this.blocks=[]}},{key:"clearBoard",value:function(){this.$el.removeChild(this.board.$el),this.board=null}}])&&O(e.prototype,r),o&&O(e,o),t}(),S=(r(1),r(0)),E=r.n(S),C="https://i.loli.net/2020/02/06/AC4znORfSHvxjFM.jpg",A=document.querySelector(".app"),M={3:"一级难度",4:"二级难度",5:"三级难度",6:"四级难度"},T=3,_=new Image;_.onload=function(){var t={img:this,width:300,height:300,row:T,col:T},e=window.pingTu=new P(t);A.innerHTML=E.a;var r=A.querySelector(".wrap"),o=A.querySelector(".preview"),n=A.querySelector(".img"),i=A.querySelector("input"),a=A.querySelector(".level"),s=A.querySelector(".reset");r.appendChild(e.$el),o.src=C,i.addEventListener("change",(function(t){!function(t,e,r){var o=new FileReader;o.onload=function(t){var o=t.target.result,n=new Image;n.onload=function(){e.changeImage(this)},n.src=o,r.src=o},o.readAsDataURL(t)}(t.target.files[0],e,o)})),n.addEventListener(b,(function(t){t.stopPropagation()})),a.addEventListener(b,(function(t){t.stopPropagation(),setTimeout((function(){!function(t,e){++T>6&&(T=3);t.changeLevel(T,T),e.innerText=M[T]}(e,a)}),100)})),s.addEventListener(b,(function(t){t.stopPropagation(),e.resetBlocks()}))},_.src=C}]);